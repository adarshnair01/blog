<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Recommendation Engine (2-Tower TFRS) | Adarsh Nair </title> <meta name="author" content="Adarsh Nair"> <meta name="description" content="Personalized recommendation system using TensorFlow Recommenders and Two-Tower architecture."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' data: https:; media-src 'self' https:; frame-src 'self' https:; connect-src 'self' https:;"> <link rel="stylesheet" href="/blog/assets/css/bootstrap.min.css?v=a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/blog/assets/css/academicons.min.css?v=f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/blog/assets/css/scholar-icons.css?v=62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/blog/assets/css/jekyll-pygments-themes-github.css?v=591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/blog/assets/css/main.css?v=d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://adarshnair.online/blog/blog/projects/3_recommendation_engine/"> <script src="/blog/assets/js/theme.js?v=5fea5159b787642c1bbc1f334d60f883"></script> <link defer rel="stylesheet" href="/blog/assets/css/jekyll-pygments-themes-native.css?v=5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://adarshnair.online" rel="external nofollow noopener" target="_blank"> Adarsh Nair </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/blog/"> </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/index.html">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/about/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/cv/">CV </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="https://adarshnair.online/books/" rel="external nofollow noopener" target="_blank">books </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="fa-solid fa-magnifying-glass"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-half-sun-moon" id="light-toggle-system"></i> <i class="fa-solid fa-moon" id="light-toggle-dark"></i> <i class="fa-solid fa-sun" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Recommendation Engine (2-Tower TFRS)</h1> <p class="post-description">Personalized recommendation system using TensorFlow Recommenders and Two-Tower architecture.</p> </header> <article> <h1 id="scalable-two-tower-recommendation-engine">Scalable Two-Tower Recommendation Engine</h1> <h2 id="executive-summary">Executive Summary</h2> <p>In the competitive landscape of e-commerce, personalization is the key driver of conversion. This project involved designing and deploying a state-of-the-art recommendation system using the <strong>Two-Tower architecture</strong> within the <strong>TensorFlow Recommenders (TFRS)</strong> framework. The system was designed to handle millions of users and items, delivering personalized product suggestions in real-time (under 50ms latency), resulting in a 15% uplift in Click-Through Rate (CTR) and a 9% increase in Gross Merchandise Value (GMV).</p> <h2 id="problem-statement">Problem Statement</h2> <p>Our legacy recommendation system relied on classical Collaborative Filtering (Matrix Factorization) which suffered from the “cold start” problem and couldn’t scale efficiently with our rapidly growing product catalog. It also failed to utilize rich content features (product descriptions, images) and context (time of day, device type). We needed a deep learning-based solution that could leverage these auxiliary features and scale linearly.</p> <h2 id="methodology">Methodology</h2> <h3 id="1-two-tower-architecture">1. Two-Tower Architecture</h3> <p>The core concept involves two separate neural networks (towers):</p> <ul> <li> <strong>Query Tower (User Tower)</strong>: Encodes user features (ID, demographics, past history) into a fixed-size embedding vector.</li> <li> <strong>Candidate Tower (Item Tower)</strong>: Encodes item features (ID, category, description embeddings) into a fixed-size embedding vector of the same dimension.</li> <li> <strong>Dot Product</strong>: The similarity score (prediction) is calculated as the dot product of the Question and Candidate vectors. This allows for extremely fast retrieval using Approximate Nearest Neighbor (ANN) search.</li> </ul> <h3 id="2-feature-engineering">2. Feature Engineering</h3> <ul> <li> <strong>User Features</strong>: <ul> <li> <code class="language-plaintext highlighter-rouge">user_id</code> (Embedding)</li> <li> <code class="language-plaintext highlighter-rouge">history_last_10_items</code> (Sequence embedding, averaged or processed via LSTM)</li> <li> <code class="language-plaintext highlighter-rouge">geolocation</code> (Hashed)</li> </ul> </li> <li> <strong>Item Features</strong>: <ul> <li> <code class="language-plaintext highlighter-rouge">item_id</code> (Embedding)</li> <li> <code class="language-plaintext highlighter-rouge">title</code> (Text embedding via DistilBERT)</li> <li> <code class="language-plaintext highlighter-rouge">category</code> (Categorical embedding)</li> <li> <code class="language-plaintext highlighter-rouge">price_normalized</code> (Continuous)</li> </ul> </li> </ul> <h3 id="3-model-training">3. Model Training</h3> <ul> <li> <strong>Framework</strong>: TensorFlow Recommenders (TFRS)</li> <li> <strong>Objective</strong>: Retrieval task (Top-K) using a Softmax/Logits loss.</li> <li> <strong>Negative Sampling</strong>: Implemented “in-batch” negative sampling for efficient training on large datasets without explicit negative pair generation.</li> <li> <strong>Optimizer</strong>: Adagrad with a dynamic learning rate schedule.</li> </ul> <h2 id="implementation-details">Implementation Details</h2> <p>The deployment pipeline is critical for a high-traffic recommendation system.</p> <h3 id="training-pipeline">Training Pipeline</h3> <ul> <li> <strong>Data</strong>: TFRecord datasets stored in GCS.</li> <li> <strong>Training</strong>: Vertex AI (Google Cloud) Custom Training Jobs.</li> <li> <strong>Embedding Generation</strong>: Once trained, the Item Tower is used to pre-compute embeddings for all active products. These are exported to an ANN Index.</li> </ul> <h3 id="serving-infrastructure">Serving Infrastructure</h3> <ul> <li> <strong>ANN Index</strong>: We used <strong>ScaNN</strong> (Scalable Nearest Neighbors) for the index service, hosted on Kubernetes.</li> <li> <strong>Online Service</strong>: A lightweight gRPC service computes the User Embedding on the fly (using the Query Tower) and queries the ScaNN index for the nearest product neighbors.</li> <li> <strong>Ranking</strong>: A second-stage “Ranking Model” (DLRM) re-ranks the top 100 candidates to optimize for conversion (CVR) rather than just relevance, taking into account real-time inventory and business logic.</li> </ul> <h2 id="challenges--solutions">Challenges &amp; Solutions</h2> <ul> <li> <strong>Challenge</strong>: Latency spikes during high traffic.</li> <li> <p><strong>Solution</strong>: Implemented aggressive caching of User Embeddings for frequent visitors using Redis, reducing redundant computations.</p> </li> <li> <strong>Challenge</strong>: The “Harry Potter” Effect (Popularity Bias). The model recommended popular items to everyone.</li> <li> <strong>Solution</strong>: Implemented “logQ” correction during training to penalize purely popular items and a post-processing dithering algorithm to inject diversity into the recommendations.</li> </ul> <h2 id="results-and-impact">Results and Impact</h2> <ul> <li> <strong>CTR Uplift</strong>: +15.3% vs. the legacy MF baseline.</li> <li> <strong>Conversion Rate</strong>: +8.5% increase.</li> <li> <strong>Catalog Coverage</strong>: Improved catalog exposure by 40%, successfully surfacing “long-tail” products that were previously buried.</li> <li> <strong>Latency</strong>: Maintained a p99 latency of 48ms even at 10,000 QPS.</li> </ul> <h2 id="future-work">Future Work</h2> <ul> <li> <strong>Real-time Session-based Recs</strong>: Integrating Transformer4Rec to model user intent within a <em>single session</em> in real-time.</li> <li> <strong>Multi-Task Learning</strong>: Optimizing for multiple objectives simultaneously (Clicks, Add-to-Cart, Purchase) using a shared-bottom, multi-tower wide &amp; deep architecture.</li> </ul> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 Adarsh Nair. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/blog/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/blog/assets/js/masonry.js?v=a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/blog/assets/js/zoom.js?v=85ddb88934d28b74e78031fd54cf8308"></script> <script src="/blog/assets/js/no_defer.js?v=2781658a0a2b13ed609542042a859126"></script> <script defer src="/blog/assets/js/common.js?v=c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/blog/assets/js/copy_code.js?v=c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/blog/assets/js/jupyter_new_tab.js?v=d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/blog/assets/js/mathjax-setup.js?v=a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/blog/assets/js/progress-bar.js?v=2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/blog/assets/js/vanilla-back-to-top.min.js?v=f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/blog/assets/js/search/ninja-keys.min.js?v=a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/blog/assets/js/search-setup.js?v=6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/blog/assets/js/search-data.js"></script> <script src="/blog/assets/js/shortcut-key.js?v=ccc841c459bfc0e64c1c2b5acd10df02"></script> </body> </html>